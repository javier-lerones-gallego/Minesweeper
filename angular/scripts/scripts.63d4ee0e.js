"use strict";angular.module("MineSweeperApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/game/:difficulty",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("MineSweeperApp").controller("MainCtrl",["$scope","$location","$modal","$log",function(a,b,c,d){a.games=[{difficulty:"Easy",rows:9,columns:9,mines:10},{difficulty:"Medium",rows:16,columns:16,mines:40},{difficulty:"Expert",rows:16,columns:30,mines:99}],a.goTo=function(a){b.path("/game/".concat(a.toLowerCase()))},a.showCustomModal=function(){var a=c.open({templateUrl:"views/custom.modal.html",controller:"CustomModalCtrl",size:"md",resolve:{formOptions:function(){return{r:9,c:9,m:10}}}});a.result.then(function(a){d.log(a)},function(){})}}]),angular.module("MineSweeperApp").controller("AboutCtrl",["$scope",function(a){a.foo="foo"}]),angular.module("MineSweeperApp").controller("GameCtrl",["$scope","$location","$routeParams","$log",function(a,b,c){switch(a.difficulty=c.difficulty,a.difficulty){case"easy":a.rows=9,a.columns=9,a.mines=10;break;case"medium":a.rows=16,a.columns=16,a.mines=40;break;case"expert":a.rows=16,a.columns=30,a.mines=99}a.flags=a.mines,a.boardController={},a.goHome=function(){b.path("/")}}]),angular.module("MineSweeperApp").controller("DialogCtrl",["$scope","$modalInstance","dialogConfig",function(a,b,c){a.config=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("MineSweeperApp").directive("square",["$pubsubService","$gameService","$log",function(a,b,c){return{templateUrl:"views/square.html",restrict:"EA",transclude:!0,require:"^board",scope:{id:"@id",mine:"@isMine",bombs:"@neighbourMines"},link:function(d,e,f,g){d.state="active",d.bombCount=parseInt(d.bombs,10),d.showCount=!1,d.iconCss="",d.buttonCss="btn-primary",d.spanCss="_".concat(d.bombCount),d.isRevealed=function(){return"revealed"===d.state},d.isQuestion=function(){return"question"===d.state},d.isFlag=function(){return"flag"===d.state},d.isActive=function(){return"active"===d.state},d.hasMineAround=function(){return d.bombCount>0},d.isEmpty=function(){return 0===d.bombCount},d.isMine=function(){return"true"===d.mine},d.setActive=function(){d.state="active",d.iconCss="",d.buttonCss="btn-primary"},d.setFlag=function(){d.state="flag",d.iconCss="fa fa-flag",d.buttonCss="btn-warning"},d.setQuestion=function(){d.state="question",d.iconCss="fa fa-question-circle",d.buttonCss="btn-success"},d.setRevealed=function(){d.state="revealed",d.iconCss="",d.buttonCss="btn-default active"},d.setExploded=function(){d.iconCss="fa fa-bomb",d.buttonCss="btn-danger"},a.on("square.reveal",function(a,c){c.id!==d.id&&b.isNeighbour(d.id,c.id,g.columns)&&d.reveal()},d),d.reveal=function(){d.isRevealed()||d.isFlag()||d.isQuestion()||(d.isEmpty()?(d.setRevealed(),a.send("square.reveal",{id:d.id})):d.hasMineAround()&&(d.showCount=!0,d.setRevealed()))},e.on("mousedown",function(a){return a.preventDefault(),1===a.button?!1:void(2===a.button&&d.isRevealed()&&d.hasMineAround())}),e.on("mouseup",function(a){0===a.button?d.isActive()&&!d.isMine()?d.$apply(d.reveal):d.isActive()&&d.isMine()&&d.$apply(d.setExploded):2===a.button&&(d.isRevealed()?d.hasMineAround():d.isActive()?d.$apply(d.setFlag):d.isFlag()?d.$apply(d.setQuestion):d.isQuestion()&&d.$apply(d.setActive))}),e.on("dblclick",function(){c.log("Dblclick detected")})}}}]),angular.module("MineSweeperApp").filter("titleCase",function(){return function(a){var b=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return a.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(a,c,d){return c>0&&c+a.length!==d.length&&a.search(b)>-1&&":"!==d.charAt(c-2)&&("-"!==d.charAt(c+a.length)||"-"===d.charAt(c-1))&&d.charAt(c-1).search(/[^\s-]/)<0?a.toLowerCase():a.substr(1).search(/[A-Z]|\../)>-1?a:a.charAt(0).toUpperCase()+a.substr(1)})}}),angular.module("MineSweeperApp").service("$gameService",function(){this.randomNumber=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},this.getRandomMines=function(a){for(var b={},c=0;c<a.mines;){var d=this.randomNumber(0,a.rows*a.columns-1);b[d]||(b[d]=!0,c+=1)}return b},this.getBombCount=function(a,b,c){var d=0;for(var e in b)a!==e&&this.isNeighbour(a,e,c)&&(d+=1);return d},this.getSquares=function(a){for(var b=this.getRandomMines(a),c=[],d=0,e=a.rows*a.columns;e>d;d++)c.push({id:d,isMine:b[d]?!0:!1,bombs:this.getBombCount(d,b,a.columns)});return c},this.isNeighbour=function(a,b,c){var d=this.toCoordinates(a,c),e=this.toCoordinates(b,c),f=Math.round(Math.sqrt(Math.pow(e.x-d.x,2)+Math.pow(e.y-d.y,2)));return 1===f},this.toCoordinates=function(a,b){var c={};return c.x=Math.floor(a/b),c.y=a%b,c}}),angular.module("MineSweeperApp").directive("board",["$gameService","$pubsubService","$log",function(a){return{templateUrl:"views/board.html",restrict:"EA",transclude:!0,scope:{rows:"@rows",columns:"@columns",mines:"@mines",difficulty:"@difficulty",control:"=control"},controller:["$scope",function(b){b.firstClick=!0,b.squares=a.getSquares({rows:b.rows,columns:b.columns,mines:b.mines}),this.rows=b.rows,this.columns=b.columns,this.squares=b.squares,b.parentController=b.control||{},b.parentController.newGame=function(){b.firstClick=!0,b.squares=a.getSquares({rows:b.rows,columns:b.columns,mines:b.mines})}}]}}]),angular.module("MineSweeperApp").directive("disableContextMenu",["$parse",function(){return function(a,b){b.bind("contextmenu",function(a){return a.preventDefault(),!1})}}]),angular.module("MineSweeperApp").factory("$pubsubService",["$rootScope",function(a){var b={};return b.send=function(b,c){c=c||{},a.$emit(b,c)},b.on=function(b,c,d){var e=a.$on(b,c);d&&d.$on("$destroy",e)},b}]),angular.module("MineSweeperApp").controller("CustomModalCtrl",["$scope","$modalInstance","formOptions",function(a,b){a.form={},a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")},a.validate=function(){}}]);